{% extends "budget/base.html" %}
{% load static %}
{% load widget_tweaks %}

{% block title %}
<title>Resumen - DARAS</title>
{% endblock title %}

{% block content %}
<!-- Heading -->
<div class="card mb-1 wow fadeIn">

    <!--Card content-->
    <div class="card-body d-sm-flex justify-content-between">

        <h6 class="mb-2 mb-sm-0 pt-1">
            <span class="text-muted">Dashboard</span>
            <span class="text-muted">/</span>
            <span>
                <a class="text-muted" href="{% url 'budget:budget-detail' budget.id %}">
                    Presupuesto
                </a>
            </span>
            <span class="text-muted">/</span>
            <span>APU</span>

        </h6>

    </div>

</div>
<!-- Heading -->

<!-- Row (1/3) -->
<div class="row">
    <!-- Budget info -->
    <div class="col-6">
        <div class="card p-2 wow fadeIn">
            <div class="card-body">
                <span class="h3 card-title">Presupuesto </span> <small>[Editar]</small>
                <br>
                <small>Información general del presupuesto</small>
                <table class="table table-sm table-hover">
                    <tr>
                        <td>N° de revisión</td>
                        <td>{{budget.rev_number}}</td>
                    </tr>
                    <tr>
                        <td>Cliente</td>
                        <td>{{budget.client.name}}</td>
                    </tr>
                    <tr>
                        <td>Descripción</td>
                        <td>
                            {{budget.subject}}
                        </td>
                    </tr>
                    <tr>
                        <td>Nivel de riesgo</td>
                        <td>{{budget.risk}}</td>
                    </tr>
                    <tr>
                        <td>Especialidad</td>
                        <td>{{budget.service}}</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    <!-- Activity info -->
    <div class="col-6">
        <div class="card p-2 wow fadeIn">
            <div class="card-body">
                <span class="h3 card-title">Actividad </span>
                <small>
                    <a class="text-primary" data-toggle="modal" data-target="#exampleModalCenter">
                        [Editar]
                    </a>
                </small>
                <br>
                <small>Información general de la actividad</small>
                <table class="table table-sm table-hover">
                    <tr>
                        <td>N° de revisión</td>
                        <td>{{subitem.rev_number}}</td>
                    </tr>
                    <tr>
                        <td> Descripción </td>
                        <td> {{subitem.description}} </td>
                    </tr>
                    <tr>
                        <td> Duración </td>
                        <td> {{subitem.duration}} </td>
                    </tr>
                    <tr>
                        <td> Cantidad </td>
                        <td> {{subitem.amount}} </td>
                    </tr>
                    <tr>
                        <td> Unidad </td>
                        <td> {{subitem.unit.name}} </td>
                    </tr>
                </table>
            </div>
        </div>
        <!-- Modal -->
        <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog"
            aria-labelledby="exampleModalCenterTitle" aria-hidden="true">

            <!-- Add .modal-dialog-centered to .modal-dialog to vertically center the modal -->
            <div class="modal-dialog modal-dialog-centered" role="document">


                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLongTitle">Modal title</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">

                        <form action="{% url 'budget:update-subitem' budget.id item.id subitem.id %}" method="post">
                            {% csrf_token %}
                            <div class="form-group">
                                <label for="" style="margin: 0;">
                                    <small>Actualizar duración</small>
                                </label>
                                <input type="number" name="duration" class="form-control form-control-sm text-center"
                                    {% if subitem.duration %}value="{{subitem.duration}}" {% endif %}>
                            </div>
                            <div class="form-group">
                                <label for="" style="margin: 0;">
                                    <small>Número de revisión</small>
                                </label>
                                <input type="number" name="rev_number" class="form-control form-control-sm text-center"
                                    {% if subitem.rev_number %}value="{{subitem.rev_number}}" {% endif %}>
                            </div>
                            <div class="form-group">
                                <label for="" style="margin: 0;">
                                    <small>Tiempo de entrega</small>
                                </label>
                                <input type="text" maxlength="50" name="delivery_time"
                                    class="form-control form-control-sm text-center"
                                    {% if subitem.delivery_time %}value="{{subitem.delivery_time}}" {% endif %}>
                            </div>
                            <button class="btn btn-block btn-primary" type="submit">Actualizar</button>
                        </form>

                    </div>
                    <!-- <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary">Save changes</button>
                    </div> -->
                </div>
            </div>
        </div>
    </div>
</div>

<!--  Row (2/3) -->
<div class="row mt-3">
    <!-- Create APU -->
    <div class="col-12">
        <div class="card p-2 wow fadeIn">
            <div class="card-body">
                <form action="" method="post" id="apuform">
                    {% csrf_token %}

                    <!-- HIDDEN INPUTS TO STORE SUBTOTAL LABELS -->
                    <div class="form-group" hidden>
                        <label for="wfsubtotal2"><small>Subtotal mano de obra</small></label>
                        <input class="form-control" type="number" name="subtotal" id="wfsubtotal2" step="0.01">
                    </div>
                    <div class="form-group" hidden>
                        <label for="msubtotal2"><small>Subtotal materiales</small></label>
                        <input class="form-control" type="number" name="subtotal" id="msubtotal2" step="0.01">
                    </div>
                    <div class="form-group" hidden>
                        <label for="equipsubtotal2"><small>Subtotal equipos y herramientas</small></label>
                        <input class="form-control" type="number" name="subtotal" id="equipsubtotal2" step="0.01">
                    </div>
                    <div class="form-group" hidden>
                        <label for="transpsubtotal2"><small>Subtotal transportes</small></label>
                        <input class="form-control" type="number" name="subtotal" id="transpsubtotal2" step="0.01">
                    </div>
                    <div class="form-group" hidden>
                        <label for="securesubtotal2"><small>Subtotal seguros y otros</small></label>
                        <input class="form-control" type="number" name="subtotal" id="securesubtotal2" step="0.01">
                    </div>
                    <!-- HIDDEN INPUTS TO STORE SUBTOTAL LABELS -->


                    <!-- Title -->
                    <h1 class="h1 card-title text-center">Análisis de precios unitarios (APU) </h1>
                    <!-- Tabs -->
                    <ul class="nav nav-tabs nav-justified md-tabs indigo" id="myTabJust" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" id="home-tab-just" data-toggle="tab" href="#workforce-tab"
                                role="tab" aria-controls="home-just" aria-selected="true">Mano de obra</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="profile-tab-just" data-toggle="tab" href="#material-tab" role="tab"
                                aria-controls="profile-just" aria-selected="false">Materiales</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="contact-tab-just" data-toggle="tab" href="#equipment-tab" role="tab"
                                aria-controls="contact-just" aria-selected="false">Herramientas</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="contact-tab-just" data-toggle="tab" href="#transport-tab" role="tab"
                                aria-controls="contact-just" aria-selected="false">Transporte</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="contact-tab-just" data-toggle="tab" href="#secure-tab" role="tab"
                                aria-controls="contact-just" aria-selected="false">Seguros</a>
                        </li>
                    </ul>
                    <!-- Tabs content -->
                    <div class="tab-content pt-5" id="myTabContentJust">

                        <!-- First tab content -->
                        <div class="tab-pane fade show active" id="workforce-tab" role="tabpanel"
                            aria-labelledby="home-tab-just">
                            <small class="card-text">Agrega elementos a esta categoría haciendo click en el botón agregar</small>
                            <table id="workforceTable" class="table table-sm mt-3">
                                <thead>
                                    <tr class="text-center">
                                        <th>
                                            Mano de obra
                                        </th>
                                        <th>
                                            Cantidad
                                        </th>
                                        <th>
                                            Salario diario
                                        </th>
                                        <th>
                                            Rendimiento
                                        </th>
                                        <th>
                                            Valor
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="workforceInputs">

                                </tbody>
                                <tfoot>
                                    <tr class="text-center grey lighten-5">
                                        <td colspan="3"></td>

                                        <td class="text-right">
                                            <strong>
                                                Subtotal
                                            </strong>
                                        </td>
                                        <td id="wfsubtotal" class="text-left">
                                            $ 0.00
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="text-left" colspan="5">
                                            <a id="addWorkforceItemButton" class="btn btn-success">AGREGAR</a>
                                            <a id="removeWorkforceItemButton" class="btn btn-danger">BORRAR</a>
                                        </td>

                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                        <!-- Second tab content -->
                        <div class="tab-pane fade" id="material-tab" role="tabpanel" aria-labelledby="profile-tab-just">
                            <small class="card-text">Agrega elementos a esta categoría haciendo click en el botón agregar</small>
                            <table id="materialTable" class="table table-sm mt-3">
                                <thead>
                                    <tr class="text-center">
                                        <th>
                                            Material
                                        </th>
                                        <th>
                                            Cantidad
                                        </th>
                                        <th>
                                            Precio unitario
                                        </th>
                                        <th>
                                            Unidad
                                        </th>
                                        <th>
                                            Valor
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="materialInputs">
                                    <!-- space left in blank intentionally -->
                                </tbody>
                                <tfoot>
                                    <tr class="text-center grey lighten-5">
                                        <td colspan="3"></td>

                                        <td class="text-right">
                                            <strong>
                                                Subtotal
                                            </strong>
                                        </td>
                                        <td id="msubtotal" class="text-left">
                                            $ 0.00
                                        </td>

                                    </tr>
                                    <tr>
                                        <td class="text-left" colspan="5">
                                            <a id="addMaterialItemButton" class="btn btn-success">AGREGAR</a>
                                            <a id="removeMaterialItemButton" class="btn btn-danger">BORRAR</a>
                                        </td>

                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                        <!-- Third tab content -->
                        <div class="tab-pane fade" id="equipment-tab" role="tabpanel" aria-labelledby="contact-tab-just">
                            <small class="card-text">Agrega elementos a esta categoría haciendo click en el botón agregar</small>
                            <table id="equipmentTable" class="table table-sm mt-3">
                                <thead>
                                    <tr class="text-center">
                                        <th>
                                            Equipo/Herramienta
                                        </th>
                                        <th>
                                            Cantidad
                                        </th>
                                        <th>
                                            Valor por día
                                        </th>
                                        <th>
                                            Rendimiento
                                        </th>
                                        <th>
                                            Valor
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="equipmentInputs">

                                </tbody>
                                <tfoot>
                                    <tr class="text-center grey lighten-5">
                                        <td colspan="3"></td>

                                        <td class="text-right">
                                            <strong>
                                                Subtotal
                                            </strong>
                                        </td>
                                        <td id="equipsubtotal" class="text-left">
                                            $ 0.00
                                        </td>

                                    </tr>
                                    <tr>
                                        <td class="text-left" colspan="5">
                                            <a id="addEquipmentItemButton" class="btn btn-success">AGREGAR</a>
                                            <a id="removeEquipmentItemButton" class="btn btn-danger">BORRAR</a>
                                        </td>

                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                        <!-- Fourth tab content -->
                        <div class="tab-pane fade" id="transport-tab" role="tabpanel" aria-labelledby="contact-tab-just">
                            <small class="card-text">Agrega elementos a esta categoría haciendo click en el botón agregar</small>
                            <table id="transportTable" class="table table-sm mt-3">
                                <thead>
                                    <tr class="text-center">
                                        <th>
                                            Transporte
                                        </th>
                                        <th>
                                            Cantidad
                                        </th>
                                        <th>
                                            Tarifa por día
                                        </th>
                                        <th>
                                            Rendimiento
                                        </th>
                                        <th>
                                            Valor
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="transportInputs">

                                </tbody>
                                <tfoot>
                                    <tr class="text-center grey lighten-5">
                                        <td colspan="3"></td>

                                        <td class="text-right">
                                            <strong>
                                                Subtotal
                                            </strong>
                                        </td>
                                        <td id="transpsubtotal" class="text-left">
                                            $ 0.00
                                        </td>

                                    </tr>
                                    <tr>
                                        <td class="text-left" colspan="5">
                                            <a id="addTransportItemButton" class="btn btn-success">AGREGAR</a>
                                            <a id="removeTransportItemButton" class="btn btn-danger">BORRAR</a>
                                        </td>

                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                        <!-- Fifth tab content -->
                        <div class="tab-pane fade" id="secure-tab" role="tabpanel" aria-labelledby="contact-tab-just">
                            <small class="card-text">Agrega elementos a esta categoría haciendo click en el botón agregar</small>
                            <table id="secureAndOthersTable" class="table table-sm mt-3">
                                <thead>
                                    <tr class="text-center">
                                        <th>
                                            Seguro / otro
                                        </th>
                                        <th>
                                            Tarifa por día
                                        </th>
                                        <th>
                                            Días
                                        </th>
                                        <th>
                                            Cantidad
                                        </th>
                                        <th>
                                            Valor
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="secureInputs">

                                </tbody>
                                <tfoot>
                                    <tr class="text-center grey lighten-5">
                                        <td colspan="3"></td>

                                        <td class="text-right">
                                            <strong>
                                                Subtotal
                                            </strong>
                                        </td>
                                        <td id="securesubtotal" class="text-left">
                                            $ 0.00
                                        </td>

                                    </tr>
                                    <tr>
                                        <td class="text-left" colspan="5">
                                            <a id="addSecureItemButton" class="btn btn-success">AGREGAR</a>
                                            <a id="removeSecureItemButton" class="btn btn-danger">BORRAR</a>
                                        </td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                    <div class="container">
                        <button type="submit" form="apuform" class="btn btn-block btn-primary mt-5">GUARDAR</button>
                    </div>
                </form>

            </div>
        </div>
    </div>
</div>

<!--  Row (3/3) -->
<div class="row mt-3">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <h3 class="h3 cart-title">Resultados</h3>
                <!-- Show total value by APU categories -->
                <table class="table" id="fixedTable">
                    <thead>
                        <tr>
                            <th style="padding: 0 30px 0 30px; text-align: center;">
                                Mano de obra
                            </th>
                            <th style="padding: 0 30px 0 30px; text-align: center;">
                                Materiales
                            </th>
                            <th style="padding: 0 30px 0 30px; text-align: center;">
                                Herramientas
                            </th>
                            <th style="padding: 0 30px 0 30px; text-align: center;">
                                Transporte
                            </th>
                            <th style="padding: 0 30px 0 30px; text-align: center;">
                                Seguros
                            </th>
                            <th style="padding: 0 30px 0 30px; text-align: center;">
                                Total
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="padding: 0 30px 0 30px; text-align: center;">
                                <p id="wfsubtotal3" class="m-0">
                                    $ 0.00
                                </p>
                            </td>
                            <td style="padding: 0 30px 0 30px; text-align: center;">
                                <p id="msubtotal3" class="m-0">
                                    $ 0.00
                                </p>
                            </td>
                            <td style="padding: 0 30px 0 30px; text-align: center;">
                                <p id="equipsubtotal3" class="m-0">
                                    $ 0.00
                                </p>
                            </td>
                            <td style="padding: 0 30px 0 30px; text-align: center;">
                                <p id="transpsubtotal3" class="m-0">
                                    $ 0.00
                                </p>
                            </td>
                            <td style="padding: 0 30px 0 30px; text-align: center;">
                                <p id="securesubtotal3" class="m-0">
                                    $ 0.00
                                </p>
                            </td>
                            <td style="padding: 0 30px 0 30px; text-align: center;">
                                <p id="totalfixedbar" class="m-0">
                                    $ 0.00
                                </p>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <!-- Hidden table intentionally-->
                <table class="m-auto" style="display: none;">
                    <thead>
                        <tr>
                            <th style="padding: 0 30px 0 30px; text-align: center;">
                                Mano de obra
                            </th>
                            <th style="padding: 0 30px 0 30px; text-align: center;">
                                Materiales
                            </th>
                            <th style="padding: 0 30px 0 30px; text-align: center;">
                                Herramientas
                            </th>
                            <th style="padding: 0 30px 0 30px; text-align: center;">
                                Transporte
                            </th>
                            <th style="padding: 0 30px 0 30px; text-align: center;">
                                Seguros
                            </th>
                            <th style="padding: 0 30px 0 30px; text-align: center;">
                                Total
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="padding: 0 30px 0 30px; text-align: center;">
                                <p id="wfsubtotal4" class="m-0">
                                    0
                                </p>
                            </td>
                            <td style="padding: 0 30px 0 30px; text-align: center;">
                                <p id="msubtotal4" class="m-0">
                                    0
                                </p>
                            </td>
                            <td style="padding: 0 30px 0 30px; text-align: center;">
                                <p id="equipsubtotal4" class="m-0">
                                    0
                                </p>
                            </td>
                            <td style="padding: 0 30px 0 30px; text-align: center;">
                                <p id="transpsubtotal4" class="m-0">
                                    0
                                </p>
                            </td>
                            <td style="padding: 0 30px 0 30px; text-align: center;">
                                <p id="securesubtotal4" class="m-0">
                                    0
                                </p>
                            </td>
                            <td style="padding: 0 30px 0 30px; text-align: center;">
                                <p id="totalfixedbar2" class="m-0">
                                    0
                                </p>
                            </td>
                            
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>



{% endblock content %}

{% block scripts %}
{{block.super}}
<!-- Humanize numbers -->
<script src="//cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.6/numeral.min.js"></script>

<!-- When Document is ready -->
<script>
    $(document).ready(function () {
        /* Highlight current sidebar item */
        $('#sidebar .list-group-item').removeClass('active');
        var $this = $('#btnSidebarBudget');
        if (!$this.hasClass('active')) {
            $this.addClass('active');
        }
        /* Highlight current sidebar item */

        

        // Use 'round10' for performance value
        (function () {
            /**Info: https://developer.mozilla.org/es/docs/Web/JavaScript/Referencia/Objetos_globales/Math/round
             * Ajuste decimal de un número.
             *
             * @param {String}  tipo  El tipo de ajuste.
             * @param {Number}  valor El numero.
             * @param {Integer} exp   El exponente (el logaritmo 10 del ajuste base).
             * @returns {Number} El valor ajustado.
             */
            function decimalAdjust(type, value, exp) {
                // Si el exp no está definido o es cero...
                if (typeof exp === 'undefined' || +exp === 0) {
                    return Math[type](value);
                }
                value = +value;
                exp = +exp;
                // Si el valor no es un número o el exp no es un entero...
                if (isNaN(value) || !(typeof exp === 'number' && exp % 1 === 0)) {
                    return NaN;
                }
                // Shift
                value = value.toString().split('e');
                value = Math[type](+(value[0] + 'e' + (value[1] ? (+value[1] - exp) : -exp)));
                // Shift back
                value = value.toString().split('e');
                return +(value[0] + 'e' + (value[1] ? (+value[1] + exp) : exp));
            }

            // Decimal round
            if (!Math.round10) {
                Math.round10 = function (value, exp) {
                    return decimalAdjust('round', value, exp);
                };
            }
            // Decimal floor
            if (!Math.floor10) {
                Math.floor10 = function (value, exp) {
                    return decimalAdjust('floor', value, exp);
                };
            }
            // Decimal ceil
            if (!Math.ceil10) {
                Math.ceil10 = function (value, exp) {
                    return decimalAdjust('ceil', value, exp);
                };
            }
        })();

        /* Workforce */
        // Update 'value' and 'subtotal' in workforce table
        function updateWorkforceValue(element) {
            /* The parameter 'element' is just for position and abstraction purposes */
            var amount = $(element).parent().parent().find(".wfamount")[0].value;
            var salary = $(element).parent().parent().find(".wfsalary")[0].value;
            var performance = $(element).parent().parent().find(".wfperformance")[0].value;
            var result = (amount * salary) / performance;
            // Insert result in 'value' input
            $(element).parent().parent().find(".wfvalue")[0].value = result.toFixed(2);

            // Update 'Subtotal' label
            var values = $(element).parent().parent().parent().find(".wfvalue");
            var aux = 0;
            for (let i = 0; i < values.length; i++) {
                aux += parseFloat(values[i].value);
            }
            var subtotal = numeral(aux).format('0,0.00');
            $("#wfsubtotal").text(`$ ${subtotal}`);
            $("#wfsubtotal2").val(aux)
            $("#wfsubtotal3").text(`$ ${subtotal}`); // Visible fixed bar
            $("#wfsubtotal4").text(aux) // Hidden fixed bar
        }
        // Add item to Workforce area
        $("#addWorkforceItemButton").click(function () {
            var url = "{% url 'api_rest:workforce-service' budget.service.id %}"
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    // console.log(data);
                    var aux = ''
                    var aux = `<option value="" selected>Mano de obra</option>`;
                    for (let i = 0; i < data.length; i++) {
                        aux += `<option value="${data[i].id}">${data[i].name}</option>`
                    }

                    var row = document.createElement('tr')
                    row.classList.add("wfrow")

                    // Workforce select
                    var first_cell = document.createElement('td')
                    var workforceSelect = document.createElement('select')
                    workforceSelect.classList.add("wfselect")
                    workforceSelect.classList.add("custom-select")
                    workforceSelect.classList.add("custom-select-sm")
                    workforceSelect.classList.add("text-center")
                    workforceSelect.setAttribute("name", "workforce")
                    workforceSelect.setAttribute("required", "true")
                    workforceSelect.innerHTML = aux;
                    first_cell.appendChild(workforceSelect)
                    row.appendChild(first_cell)

                    // Workforce amount
                    var second_cell = document.createElement('td')
                    var workforceAmountInput = document.createElement('input')
                    workforceAmountInput.classList.add("wfamount")
                    workforceAmountInput.classList.add("form-control")
                    workforceAmountInput.classList.add("form-control-sm")
                    workforceAmountInput.classList.add("text-center")
                    workforceAmountInput.setAttribute('name', 'wfamount')
                    workforceAmountInput.setAttribute('required', 'true')
                    workforceAmountInput.setAttribute('placeholder', 'Cantidad')
                    workforceAmountInput.setAttribute('type', 'number')
                    second_cell.appendChild(workforceAmountInput)
                    row.appendChild(second_cell)

                    // Workforce daily salary
                    var third_cell = document.createElement('td')
                    var dailyPriceInput = document.createElement('input')
                    dailyPriceInput.classList.add("wfsalary")
                    dailyPriceInput.classList.add("form-control")
                    dailyPriceInput.classList.add("form-control-sm")
                    dailyPriceInput.classList.add("text-center")
                    dailyPriceInput.setAttribute('name', 'wfprice')
                    dailyPriceInput.setAttribute('type', 'number')
                    dailyPriceInput.setAttribute('step', '0.01')
                    dailyPriceInput.setAttribute('placeholder', 'Salario diario')
                    third_cell.appendChild(dailyPriceInput)
                    row.appendChild(third_cell)

                    // Workforce performance
                    var fourth_cell = document.createElement('td')
                    var performanceInput = document.createElement('input')
                    performanceInput.classList.add("wfperformance")
                    performanceInput.classList.add("form-control")
                    performanceInput.classList.add("form-control-sm")
                    performanceInput.classList.add("text-center")
                    performanceInput.setAttribute('name', 'wfperformance')
                    performanceInput.setAttribute('type', 'number')
                    performanceInput.setAttribute('step', '0.01')
                    performanceInput.setAttribute('placeholder', 'Rendimiento')
                    fourth_cell.appendChild(performanceInput)
                    row.appendChild(fourth_cell)

                    // Workforce value
                    var fifth_cell = document.createElement('td')
                    var valueInput = document.createElement('input')
                    valueInput.classList.add("wfvalue")
                    valueInput.classList.add("form-control")
                    valueInput.classList.add("form-control-sm")
                    valueInput.classList.add("text-center")
                    valueInput.setAttribute('name', 'wfvalue')
                    valueInput.setAttribute('type', 'number')
                    valueInput.setAttribute('step', '0.01')
                    valueInput.setAttribute('placeholder', 'Valor')
                    fifth_cell.appendChild(valueInput)
                    row.appendChild(fifth_cell)

                    // Add row to table
                    document.getElementById('workforceInputs').appendChild(row)
                })
                .catch(error => console.log(error))


        })
        // Remove last item from Workforce area
        $("#removeWorkforceItemButton").click(function () {
            var x = $("#workforceInputs").children().length
            if (x != 0) {
                $("#workforceInputs").children().last().remove()
            }

        })
        // Insert salary and performance value
        $("#workforceInputs").on("click", "tr td .wfselect", function (e) {
            // Value selected in workforce select
            var option = $(this).children("option:selected").val()
            // API url
            var url = "{% url 'api_rest:workforce-service' budget.service.id %}"
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    // Element in API query result that match with the option value selected
                    var element = data.find(element => element.id == option)
                    // Budget type of cost (per hour / day / month)
                    var type = "{{budget.time}}"
                    var risk_value = parseFloat("{{budget.risk.value}}")
                    console.log(risk_value);
                    switch (type) {
                        case "1":
                            // Insert in the salary input of the same row the salary of the option selected
                            $(this).parent().parent().find(".wfsalary")[0].value = ((element
                                .daily_salary * risk_value) / 8).toFixed(2);
                            break;
                        case "2":
                            $(this).parent().parent().find(".wfsalary")[0].value = ((element
                                .daily_salary * risk_value)).toFixed(2);
                            break;
                        case "3":
                            $(this).parent().parent().find(".wfsalary")[0].value = ((element
                                .daily_salary * risk_value) * 30).toFixed(2);
                            break;
                    }



                    /* ....... */

                    // Insert performance value in the input '.wfperformance' of the same row
                    var subitemAmount = '{{subitem.amount}}';
                    var itemDuration = '{{subitem.duration}}';
                    var performance = subitemAmount / itemDuration;

                    $(this).parent().parent().find(".wfperformance")[0].value = Math.round10(
                        performance, -1);
                })
                .catch(error => {
                    console.log(error);
                })
        })
        // Insert 'value' for each forkworce row 
        $("#workforceInputs").delegate(".wfamount", "keyup", function (e) {
            updateWorkforceValue(this);
        });
        $("#workforceInputs").on("change", "tr td .wfamount", function (e) {
            updateWorkforceValue(this)
        })
        /* end of Workforce */

        /* Material */
        // Update 'value' and 'subtotal' in material table
        function updateMaterialValue(element) {
            /* The parameter 'element' is just for position and abstraction purposes */
            var amount = $(element).parent().parent().find(".mamount")[0].value;
            var munitprice = $(element).parent().parent().find(".munitprice")[0].value;
            var value = (amount * munitprice);
            // Insert result in 'value' input
            $(element).parent().parent().find(".mvalue")[0].value = value.toFixed(2);

            // Update 'Subtotal' label
            var values = $(element).parent().parent().parent().find(".mvalue");
            var aux = 0;
            for (let i = 0; i < values.length; i++) {
                aux += parseFloat(values[i].value);
            }
            var subtotal = numeral(aux).format('0,0.00');
            $("#msubtotal").text(`$ ${subtotal}`);
            $("#msubtotal2").val(aux)
            $("#msubtotal3").text(`$ ${subtotal}`); // Visible fixed bar
            $("#msubtotal4").text(aux) // hidden fixed bar
        }
        // Add item to Material area
        $("#addMaterialItemButton").click(function () {
            var selectedService = '{{budget.service.id}}'
            if (selectedService != '') {
                var url = "{% url 'api_rest:material-service' budget.service.id %}"
                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        // console.log(data);
                        var aux = ''
                        var aux = `<option value="" selected>Materiales</option>`;
                        for (let i = 0; i < data.length; i++) {
                            aux += `<option value="${data[i].id}">${data[i].name}</option>`
                        }

                        var row = document.createElement('tr')

                        var first_cell = document.createElement('td')
                        var materialSelect = document.createElement('select')
                        materialSelect.classList.add("mselect")
                        materialSelect.classList.add("custom-select")
                        materialSelect.classList.add("custom-select-sm")
                        materialSelect.classList.add("text-center")
                        materialSelect.setAttribute("name", "material")
                        materialSelect.setAttribute("required", "true")
                        materialSelect.innerHTML = aux;
                        first_cell.appendChild(materialSelect)
                        row.appendChild(first_cell)

                        var second_cell = document.createElement('td')
                        var materialAmountInput = document.createElement('input')
                        materialAmountInput.classList.add("mamount")
                        materialAmountInput.classList.add("form-control")
                        materialAmountInput.classList.add("form-control-sm")
                        materialAmountInput.classList.add("text-center")
                        materialAmountInput.setAttribute('name', 'mamount')
                        materialAmountInput.setAttribute('required', 'true')
                        materialAmountInput.setAttribute('placeholder', 'Cantidad')
                        materialAmountInput.setAttribute('type', 'number')
                        second_cell.appendChild(materialAmountInput)
                        row.appendChild(second_cell)

                        var third_cell = document.createElement('td')
                        var materialDailyPriceInput = document.createElement('input')
                        materialDailyPriceInput.classList.add("munitprice")
                        materialDailyPriceInput.classList.add("form-control")
                        materialDailyPriceInput.classList.add("form-control-sm")
                        materialDailyPriceInput.classList.add("text-center")
                        materialDailyPriceInput.setAttribute('name', 'mprice')
                        materialDailyPriceInput.setAttribute('type', 'number')
                        materialDailyPriceInput.setAttribute('step', '0.01')
                        materialDailyPriceInput.setAttribute('placeholder', 'Precio unitario')
                        third_cell.appendChild(materialDailyPriceInput)
                        row.appendChild(third_cell)

                        var fourth_cell = document.createElement('td')
                        var materialPerformanceInput = document.createElement('input')
                        materialPerformanceInput.classList.add("munit")
                        materialPerformanceInput.classList.add("form-control")
                        materialPerformanceInput.classList.add("form-control-sm")
                        materialPerformanceInput.classList.add("text-center")
                        materialPerformanceInput.setAttribute('name', 'munit')
                        materialPerformanceInput.setAttribute('type', 'text')
                        materialPerformanceInput.setAttribute('readonly', 'true')
                        materialPerformanceInput.setAttribute('placeholder', 'Unidad')
                        fourth_cell.appendChild(materialPerformanceInput)
                        row.appendChild(fourth_cell)

                        var fifth_cell = document.createElement('td')
                        var materialValueInput = document.createElement('input')
                        materialValueInput.classList.add("mvalue")
                        materialValueInput.classList.add("form-control")
                        materialValueInput.classList.add("form-control-sm")
                        materialValueInput.classList.add("text-center")
                        materialValueInput.setAttribute('name', 'mvalue')
                        materialValueInput.setAttribute('type', 'number')
                        materialValueInput.setAttribute('placeholder', 'Valor')
                        fifth_cell.appendChild(materialValueInput)
                        row.appendChild(fifth_cell)

                        document.getElementById('materialInputs').appendChild(row)
                    })
                    .catch(error => console.log(error))
            }
        })
        // Remove last item from Material area
        $("#removeMaterialItemButton").click(function () {
            var x = $("#materialInputs").children().length
            if (x != 0) {
                $("#materialInputs").children().last().remove()
            }
        })
        // Insert 'unit' and 'unit value' when click option from select input
        $("#materialInputs").on("click", "tr td .mselect", function (e) {
            // Value selected in workforce select
            var option = $(this).children("option:selected").val()
            // API url
            var url = "{% url 'api_rest:material-service' budget.service.id %}"
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    // Element in API query result that matches with the option value selected
                    var element = data.find(element => element.id == option)
                    // Insert in the unit value input of the same row the unit value of the option selected
                    $(this).parent().parent().find(".munitprice")[0].value = element.daily_price;
                    // Insert 'unit' name in the input of the same row
                    $(this).parent().parent().find(".munit")[0].value = element.unit;
                })
                .catch(error => {
                    console.log(error);
                })
        })
        // Insert 'value' for each Material row 
        $("#materialInputs").delegate(".mamount", "keyup", function (e) {
            updateMaterialValue(this);
        });
        $("#materialInputs").on("change", "tr td .mamount", function (e) {
            updateMaterialValue(this)
        })
        /* end of Material */



        /* Equipment and tools */
        // Update 'value' and 'subtotal' in table
        function updateEquipmentValue(element) {
            /* The parameter 'element' is just for position and abstraction purposes */
            var amount = $(element).parent().parent().find(".equipamount")[0].value;
            var munitprice = $(element).parent().parent().find(".equipdailyprice")[0].value;
            var value = (amount * munitprice);
            // Insert result in 'value' input
            $(element).parent().parent().find(".equipvalue")[0].value = value.toFixed(2);

            // Update 'Subtotal' label
            var values = $(element).parent().parent().parent().find(".equipvalue");
            var aux = 0;
            for (let i = 0; i < values.length; i++) {
                aux += parseFloat(values[i].value);
            }

            var subtotal = numeral(aux).format('0,0.00');
            $("#equipsubtotal").text(`$ ${subtotal}`);
            $("#equipsubtotal2").val(aux)
            $("#equipsubtotal3").text(`$ ${subtotal}`); // Visible fixed bar
            $("#equipsubtotal4").text(aux) // Hidden fixed bar
        }
        // Add item to Equipment area
        $("#addEquipmentItemButton").click(function () {
            var selectedService = '{{budget.service.id}}'
            if (selectedService != '') {
                var url = "{% url 'api_rest:equipment-service' budget.service.id %}"
                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        // console.log(data);
                        var aux = ''
                        var aux = `<option value=""  selected>Equipo</option>`;
                        for (let i = 0; i < data.length; i++) {
                            aux += `<option value="${data[i].id}">${data[i].name}</option>`
                        }

                        var row = document.createElement('tr')

                        var first_cell = document.createElement('td')
                        var equipmentSelect = document.createElement('select')
                        equipmentSelect.classList.add("equipselect")
                        equipmentSelect.classList.add("custom-select")
                        equipmentSelect.classList.add("custom-select-sm")
                        equipmentSelect.classList.add("text-center")
                        equipmentSelect.setAttribute("name", "equipment")
                        equipmentSelect.setAttribute("required", "true")
                        equipmentSelect.innerHTML = aux;
                        first_cell.appendChild(equipmentSelect)
                        row.appendChild(first_cell)

                        var second_cell = document.createElement('td')
                        var equipmentAmountInput = document.createElement('input')
                        equipmentAmountInput.classList.add("equipamount")
                        equipmentAmountInput.classList.add("form-control")
                        equipmentAmountInput.classList.add("form-control-sm")
                        equipmentAmountInput.classList.add("text-center")
                        equipmentAmountInput.setAttribute('name', 'equipamount')
                        equipmentAmountInput.setAttribute('required', 'true')
                        equipmentAmountInput.setAttribute('placeholder', 'Cantidad')
                        equipmentAmountInput.setAttribute('type', 'number')
                        second_cell.appendChild(equipmentAmountInput)
                        row.appendChild(second_cell)

                        var third_cell = document.createElement('td')
                        var equipmentDailyPriceInput = document.createElement('input')
                        equipmentDailyPriceInput.classList.add("equipdailyprice")
                        equipmentDailyPriceInput.classList.add("form-control")
                        equipmentDailyPriceInput.classList.add("form-control-sm")
                        equipmentDailyPriceInput.classList.add("text-center")
                        equipmentDailyPriceInput.setAttribute('name', 'equipprice')
                        equipmentDailyPriceInput.setAttribute('type', 'number')
                        equipmentDailyPriceInput.setAttribute('placeholder', 'Valor diario')
                        third_cell.appendChild(equipmentDailyPriceInput)
                        row.appendChild(third_cell)

                        var fourth_cell = document.createElement('td')
                        var performanceInput = document.createElement('input')
                        performanceInput.classList.add("equiperform")
                        performanceInput.classList.add("form-control")
                        performanceInput.classList.add("form-control-sm")
                        performanceInput.classList.add("text-center")
                        performanceInput.setAttribute('name', 'equipperformance')
                        performanceInput.setAttribute('type', 'number')
                        performanceInput.setAttribute('step', '0.01')
                        performanceInput.setAttribute('placeholder', 'Rendimiento')
                        fourth_cell.appendChild(performanceInput)
                        row.appendChild(fourth_cell)

                        var fifth_cell = document.createElement('td')
                        var valueInput = document.createElement('input')
                        valueInput.classList.add("equipvalue")
                        valueInput.classList.add("form-control")
                        valueInput.classList.add("form-control-sm")
                        valueInput.classList.add("text-center")
                        valueInput.setAttribute('name', 'equipvalue')
                        valueInput.setAttribute('type', 'number')
                        valueInput.setAttribute('placeholder', 'Valor')
                        fifth_cell.appendChild(valueInput)
                        row.appendChild(fifth_cell)

                        document.getElementById('equipmentInputs').appendChild(row)
                    })
                    .catch(error => console.log(error))
            }
        })
        // Remove last item from Equipment area
        $("#removeEquipmentItemButton").click(function () {
            var x = $("#equipmentInputs").children().length
            if (x != 0) {
                $("#equipmentInputs").children().last().remove()
            }
        })
        // Insert 'performance' and 'unit value' when click option from select input
        $("#equipmentInputs").on("click", "tr td .equipselect", function (e) {
            // Value selected in workforce select
            var option = $(this).children("option:selected").val()
            // API url
            var url = "{% url 'api_rest:equipment-service' budget.service.id %}"
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    // Element in API query result that matches with the option value selected
                    var element = data.find(element => element.id == option)
                    var type = "{{budget.time}}"
                    switch (type) {
                        case "1":
                            // Insert in the daily price input of the same row the daily price value of the option selected
                            $(this).parent().parent().find(".equipdailyprice")[0].value = (element
                                .daily_price / 8).toFixed(2);
                            break;
                        case "2":
                            // Insert in the daily price input of the same row the daily price value of the option selected
                            $(this).parent().parent().find(".equipdailyprice")[0].value = (element
                                .daily_price);
                            break
                        case "3":
                            // Insert in the daily price input of the same row the daily price value of the option selected
                            $(this).parent().parent().find(".equipdailyprice")[0].value = (element
                                .daily_price * 30).toFixed(2);
                            break
                    }

                    // Insert performance value in the input '.equiperform' of the same row
                    var subitemAmount = '{{subitem.amount}}';
                    var itemDuration = '{{subitem.duration}}';
                    var performance = subitemAmount / itemDuration;
                    $(this).parent().parent().find(".equiperform")[0].value = Math.round10(
                        performance, -1);
                })
                .catch(error => {
                    console.log(error);
                })
        })
        // Insert 'value' for each row 
        $("#equipmentInputs").delegate(".equipamount", "keyup", function (e) {
            updateEquipmentValue(this);
        });
        $("#equipmentInputs").on("change", "tr td .equipamount", function (e) {
            updateEquipmentValue(this)
        })
        /* end of Equipment and tools */


        /* Transport */

        // Update 'value' and 'subtotal' in table
        function updateTransportValue(element) {
            /* The parameter 'element' is just for position and abstraction purposes */
            var amount = $(element).parent().parent().find(".transpamount")[0].value;
            var munitprice = $(element).parent().parent().find(".transpdailyvalue")[0].value;
            var value = (amount * munitprice);
            // Insert result in 'value' input
            $(element).parent().parent().find(".transpvalue")[0].value = value.toFixed(2);

            // Update 'Subtotal' label
            var values = $(element).parent().parent().parent().find(".transpvalue");
            var aux = 0;
            for (let i = 0; i < values.length; i++) {
                aux += parseFloat(values[i].value);
            }
            var subtotal = numeral(aux).format('0,0.00');
            $("#transpsubtotal").text(`$ ${subtotal}`);
            $("#transpsubtotal2").val(aux)
            $("#transpsubtotal3").text(`$ ${subtotal}`); // Visible fixed bar
            $("#transpsubtotal4").text(aux) // Hidden fixed bar
        }
        // Add item to Transport area
        $("#addTransportItemButton").click(function () {
            var selectedService = '{{budget.service.id}}'
            if (selectedService != '') {
                var url = "{% url 'api_rest:transports-list' %}"
                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        // console.log(data);
                        var aux = ''
                        var aux = `<option value=""  selected>Transporte</option>`;
                        for (let i = 0; i < data.length; i++) {
                            aux += `<option value="${data[i].id}">${data[i].name}</option>`
                        }

                        var row = document.createElement('tr')

                        var first_cell = document.createElement('td')
                        var transportSelect = document.createElement('select')
                        transportSelect.classList.add("transpselect")
                        transportSelect.classList.add("custom-select")
                        transportSelect.classList.add("custom-select-sm")
                        transportSelect.classList.add("text-center")
                        transportSelect.setAttribute("name", "transport")
                        transportSelect.setAttribute("required", "true")
                        transportSelect.innerHTML = aux;
                        first_cell.appendChild(transportSelect)
                        row.appendChild(first_cell)

                        var second_cell = document.createElement('td')
                        var transportAmountInput = document.createElement('input')
                        transportAmountInput.classList.add("transpamount")
                        transportAmountInput.classList.add("form-control")
                        transportAmountInput.classList.add("form-control-sm")
                        transportAmountInput.classList.add("text-center")
                        transportAmountInput.setAttribute('name', 'transpamount')
                        transportAmountInput.setAttribute('required', 'true')
                        transportAmountInput.setAttribute('placeholder', 'Cantidad')
                        transportAmountInput.setAttribute('type', 'number')
                        second_cell.appendChild(transportAmountInput)
                        row.appendChild(second_cell)

                        var third_cell = document.createElement('td')
                        var transportDailyPriceInput = document.createElement('input')
                        transportDailyPriceInput.classList.add("transpdailyvalue")
                        transportDailyPriceInput.classList.add("form-control")
                        transportDailyPriceInput.classList.add("form-control-sm")
                        transportDailyPriceInput.classList.add("text-center")
                        transportDailyPriceInput.setAttribute('name', 'transpprice')
                        transportDailyPriceInput.setAttribute('type', 'number')
                        transportDailyPriceInput.setAttribute('placeholder', 'Tarifa diaria')
                        third_cell.appendChild(transportDailyPriceInput)
                        row.appendChild(third_cell)

                        var fourth_cell = document.createElement('td')
                        var transportPerformanceInput = document.createElement('input')
                        transportPerformanceInput.classList.add("transperform")
                        transportPerformanceInput.classList.add("form-control")
                        transportPerformanceInput.classList.add("form-control-sm")
                        transportPerformanceInput.classList.add("text-center")
                        transportPerformanceInput.setAttribute('name', 'transpperformance')
                        transportPerformanceInput.setAttribute('type', 'number')
                        transportPerformanceInput.setAttribute('step', '0.01')
                        transportPerformanceInput.setAttribute('placeholder', 'Rendimiento')
                        fourth_cell.appendChild(transportPerformanceInput)
                        row.appendChild(fourth_cell)

                        var fifth_cell = document.createElement('td')
                        var transportValueInput = document.createElement('input')
                        transportValueInput.classList.add("transpvalue")
                        transportValueInput.classList.add("form-control")
                        transportValueInput.classList.add("form-control-sm")
                        transportValueInput.classList.add("text-center")
                        transportValueInput.setAttribute('name', 'transpvalue')
                        transportValueInput.setAttribute('type', 'number')
                        transportValueInput.setAttribute('placeholder', 'Valor')
                        fifth_cell.appendChild(transportValueInput)
                        row.appendChild(fifth_cell)

                        document.getElementById('transportInputs').appendChild(row)
                    })
                    .catch(error => console.log(error))
            }
        })
        // Remove last item from Transport area
        $("#removeTransportItemButton").click(function () {
            var x = $("#transportInputs").children().length
            if (x != 0) {
                $("#transportInputs").children().last().remove()
            }
        })
        // Insert 'unit' and 'performance' when click option from select input
        $("#transportInputs").on("click", "tr td .transpselect", function (e) {
            // Value selected in transport select
            var option = $(this).children("option:selected").val()
            // API url
            var url = "{% url 'api_rest:transports-list' %}"
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    // Element in API query result that matches with the option value selected
                    var element = data.find(element => element.id == option)
                    // Insert in the daily price input of the same row the daily price value of the option selected
                    $(this).parent().parent().find(".transpdailyvalue")[0].value = element
                        .daily_price;

                    // Insert performance value in the input '.equiperform' of the same row
                    var subitemAmount = '{{subitem.amount}}';
                    var itemDuration = '{{subitem.duration}}';
                    var performance = subitemAmount / itemDuration;
                    $(this).parent().parent().find(".transperform")[0].value = Math.round10(
                        performance, -1);;
                })
                .catch(error => {
                    console.log(error);
                })
        })
        // Insert 'value' for each row 
        $("#transportInputs").delegate(".transpamount", "keyup", function (e) {
            updateTransportValue(this);
        });
        $("#transportInputs").on("change", "tr td .transpamount", function (e) {
            updateTransportValue(this)
        })
        /* end of Transport */

        /* Secure and Others */
        // Update 'value' and 'subtotal' in table
        function updateSecureValue(element) {
            /* The parameter 'element' is just for position and abstraction purposes */
            var amount = $(element).parent().parent().find(".secureamount")[0].value;
            var munitprice = $(element).parent().parent().find(".securedailyvalue")[0].value;
            var days = $(element).parent().parent().find(".securedays")[0].value;

            var value = amount * (munitprice * days);
            // Insert result in 'value' input
            $(element).parent().parent().find(".securevalue")[0].value = value.toFixed(2);

            // Update 'Subtotal' label
            var values = $(element).parent().parent().parent().find(".securevalue");
            var aux = 0;
            for (let i = 0; i < values.length; i++) {
                aux += parseFloat(values[i].value);
            }
            
            var subtotal = numeral(aux).format('0,0.00');
            $("#securesubtotal").text(`$ ${subtotal}`);
            $("#securesubtotal2").val(aux) 
            $("#securesubtotal3").text(`$ ${subtotal}`); // visible fixed bar
            $("#securesubtotal4").text(aux) // hidden fixed bar
        }
        // Add item to Secure and Others area
        $("#addSecureItemButton").click(function () {
            var selectedService = '{{budget.service.id}}'
            if (selectedService != '') {
                var url = "{% url 'api_rest:secures-list' %}"
                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        // console.log(data);
                        var aux = ''
                        var aux = `<option value=""  selected>Seguros y Otros</option>`;
                        for (let i = 0; i < data.length; i++) {
                            aux += `<option value="${data[i].id}">${data[i].name}</option>`
                        }

                        var row = document.createElement('tr')

                        var first_cell = document.createElement('td')
                        var secureSelect = document.createElement('select')
                        secureSelect.classList.add("secureselect")
                        secureSelect.classList.add("custom-select")
                        secureSelect.classList.add("custom-select-sm")
                        secureSelect.classList.add("text-center")
                        secureSelect.setAttribute("name", "secure")
                        secureSelect.setAttribute("required", "true")
                        secureSelect.innerHTML = aux;
                        first_cell.appendChild(secureSelect)
                        row.appendChild(first_cell)

                        var third_cell = document.createElement('td')
                        var secureDailyPriceInput = document.createElement('input')
                        secureDailyPriceInput.classList.add("securedailyvalue")
                        secureDailyPriceInput.classList.add("form-control")
                        secureDailyPriceInput.classList.add("form-control-sm")
                        secureDailyPriceInput.classList.add("text-center")
                        secureDailyPriceInput.setAttribute('name', 'secureprice')
                        secureDailyPriceInput.setAttribute('type', 'number')
                        secureDailyPriceInput.setAttribute('step', '0.01')
                        secureDailyPriceInput.setAttribute('readonly', 'true')
                        secureDailyPriceInput.setAttribute('placeholder', 'Tarifa diaria')
                        third_cell.appendChild(secureDailyPriceInput)
                        row.appendChild(third_cell)

                        var fourth_cell = document.createElement('td')
                        var secureDaysInput = document.createElement('input')
                        secureDaysInput.classList.add("securedays")
                        secureDaysInput.classList.add("form-control")
                        secureDaysInput.classList.add("form-control-sm")
                        secureDaysInput.classList.add("text-center")
                        secureDaysInput.setAttribute('name', 'secureperformance')
                        secureDaysInput.setAttribute('type', 'number')
                        secureDaysInput.setAttribute('placeholder', 'Días')
                        fourth_cell.appendChild(secureDaysInput)
                        row.appendChild(fourth_cell)

                        var second_cell = document.createElement('td')
                        var secureAmountInput = document.createElement('input')
                        secureAmountInput.classList.add("secureamount")
                        secureAmountInput.classList.add("form-control")
                        secureAmountInput.classList.add("form-control-sm")
                        secureAmountInput.classList.add("text-center")
                        secureAmountInput.setAttribute('name', 'secureamount')
                        secureAmountInput.setAttribute('required', 'true')
                        secureAmountInput.setAttribute('placeholder', 'Cantidad')
                        secureAmountInput.setAttribute('type', 'number')
                        second_cell.appendChild(secureAmountInput)
                        row.appendChild(second_cell)

                        var fifth_cell = document.createElement('td')
                        var secureValueInput = document.createElement('input')
                        secureValueInput.classList.add("securevalue")
                        secureValueInput.classList.add("form-control")
                        secureValueInput.classList.add("form-control-sm")
                        secureValueInput.classList.add("text-center")
                        secureValueInput.setAttribute('name', 'securevalue')
                        secureValueInput.setAttribute('type', 'number')
                        secureValueInput.setAttribute('step', '0.01')
                        secureValueInput.setAttribute('placeholder', 'Valor')
                        fifth_cell.appendChild(secureValueInput)
                        row.appendChild(fifth_cell)

                        document.getElementById('secureInputs').appendChild(row)
                    })
                    .catch(error => console.log(error))
            }
        })
        // Remove last item from Secure and Others area
        $("#removeSecureItemButton").click(function () {
            var x = $("#secureInputs").children().length
            if (x != 0) {
                $("#secureInputs").children().last().remove()
            }
        })
        // Insert 'unit' and 'performance' when click option from select input
        $("#secureInputs").on("click", "tr td .secureselect", function (e) {
            // Value selected in transport select
            var option = $(this).children("option:selected").val()
            // API url
            var url = "{% url 'api_rest:secures-list' %}"
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    // Element in API query result that matches with the option value selected
                    var element = data.find(element => element.id == option)
                    // Insert in the daily price input of the same row the daily price value of the option selected
                    $(this).parent().parent().find(".securedailyvalue")[0].value = element
                        .daily_price;

                    // Insert performance value in the input '.equiperform' of the same row
                    // var subitemAmount = '{{subitem.amount}}';
                    // var itemDuration = '{{subitem.duration}}';
                    // var performance = subitemAmount / itemDuration;
                    // $(this).parent().parent().find(".secureperformance")[0].value = Math.round10(performance, -1);;
                })
                .catch(error => {
                    console.log(error);
                })
        })
        // Insert 'value' for each row 
        $("#secureInputs").delegate(".secureamount", "keyup", function (e) {
            updateSecureValue(this);
        });
        $("#secureInputs").on("change", "tr td .secureamount", function (e) {
            updateSecureValue(this)
        });
        /* end of Secure and Others */
        
        /* Calculate total of APU every interval of time */
        window.setInterval(function(){
            var wf = parseFloat($("#wfsubtotal4").text()) // hidden
            var mt = parseFloat($("#msubtotal4").text()) // hidden
            var et = parseFloat($("#equipsubtotal4").text()) // hidden
            var tr = parseFloat($("#transpsubtotal4").text()) // hidden
            var so = parseFloat($("#securesubtotal4").text()) // hidden
            var aux = wf+mt+et+tr+so
            var r = numeral(aux).format('0,0.00');
            $("#totalfixedbar").text("$ "+r) // Visible            
        }, 500);



    });
</script>
{% endblock scripts %}